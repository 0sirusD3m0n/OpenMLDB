db: test_zw
debugs: ["avg-string"]
cases:
  -
    id: 0
    desc: max
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1, max(c3) OVER w1 as m3,max(c4) OVER w1 as m4,max(c5) OVER w1 as m5,max(c6) OVER w1 as m6,max(c7) OVER w1 as m7,max(c8) OVER w1 as m8,max(c9) OVER w1 as m9 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      order: id
      columns: ["id int","c1 string","m3 int","m4 bigint","m5 float","m6 double","m7 timestamp","m8 date","m9 string"]
      rows:
        - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
        - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
        - [3,"aa",4,33,1.4,2.4,1590738992000,"2020-05-03","c"]
  -
    id: 1
    desc: min
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1, min(c3) OVER w1 as m3,min(c4) OVER w1 as m4,min(c5) OVER w1 as m5,min(c6) OVER w1 as m6,min(c7) OVER w1 as m7,min(c8) OVER w1 as m8,min(c9) OVER w1 as m9 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      order: id
      columns: ["id int","c1 string","m3 int","m4 bigint","m5 float","m6 double","m7 timestamp","m8 date","m9 string"]
      rows:
        - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
        - [2,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
        - [3,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
  -
    id: 2
    desc: count
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1, count(c3) OVER w1 as m3,count(c4) OVER w1 as m4,count(c5) OVER w1 as m5,count(c6) OVER w1 as m6,count(c7) OVER w1 as m7,count(c8) OVER w1 as m8,count(c9) OVER w1 as m9 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      order: id
      columns: ["id int","c1 string","m3 bigint","m4 bigint","m5 bigint","m6 bigint","m7 bigint","m8 bigint","m9 bigint"]
      rows:
        - [1,"aa",1,1,1,1,1,1,1]
        - [2,"aa",2,2,2,2,2,2,2]
        - [3,"aa",3,3,3,3,3,3,3]
  -
    id: 3
    desc: sum
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1, sum(c3) OVER w1 as m3,sum(c4) OVER w1 as m4,sum(c5) OVER w1 as m5,sum(c6) OVER w1 as m6 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      order: id
      columns: ["id int","c1 string","m3 int","m4 bigint","m5 float","m6 double"]
      rows:
        - [1,"aa",1,30,1.1,2.1]
        - [2,"aa",5,63,2.5,4.5]
        - [3,"aa",8,95,3.7999997,6.799999999999999]
  -
    id: 4
    desc: avg
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",1,33,1.1,2.1,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1, avg(c3) OVER w1 as m3,avg(c4) OVER w1 as m4,avg(c5) OVER w1 as m5,avg(c6) OVER w1 as m6 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      order: id
      columns: ["id int","c1 string","m3 double","m4 double","m5 double","m6 double"]
      rows:
        - [1,"aa",1,30,1.100000023841858,2.1]
        - [2,"aa",2.5,31.5,1.25,2.25]
        - [3,"aa",2,32,1.200000007947286,2.1999999999999997]
  -
    id: 5
    desc: sum-timestamp
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1,sum(c7) OVER w1 as m7 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      order: id
      columns: ["id int","c1 string","m7 timestamp"]
      rows:
        - [1,"aa",1590738990000]
        - [2,"aa",3181477981000]
        - [3,"aa",4772216973000]
  -
    id: 6
    desc: avg-timestamp
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1,avg(c7) OVER w1 as m7 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      success: false
  -
    id: 7
    desc: sum-date
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1,sum(c8) OVER w1 as m8 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      success: false
  -
    id: 8
    desc: sum-string
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1,sum(c9) OVER w1 as m9 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      success: false
  -
    id: 9
    desc: avg-date
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1,avg(c8) OVER w1 as m8 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      success: false
  -
    id: 10
    desc: avg-string
    inputs:
      -
        columns : ["id int","c1 string","c3 int","c4 bigint","c5 float","c6 double","c7 timestamp","c8 date","c9 string"]
        indexs: ["index1:c1:c7"]
        rows:
          - [1,"aa",1,30,1.1,2.1,1590738990000,"2020-05-01","a"]
          - [2,"aa",4,33,1.4,2.4,1590738991000,"2020-05-03","c"]
          - [3,"aa",3,32,1.3,2.3,1590738992000,"2020-05-02","b"]
    sql: |
      SELECT id, c1,avg(c9) OVER w1 as m9 FROM {0} WINDOW
      w1 AS (PARTITION BY {0}.c1 ORDER BY {0}.c7 ROWS BETWEEN 2 PRECEDING AND CURRENT ROW);
    expect:
      success: false