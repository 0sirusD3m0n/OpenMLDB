db: test_zw
debugs: []
cases:
  -
    id: 1
    desc: 正常使用子查询
    inputs:
      -
        columns : ["c1 string","c2 int","c3 bigint","c4 timestamp"]
        indexs: ["index1:c1:c4"]
        rows:
          - ["aa",2,3,1590738989000]
          - ["bb",21,31,1590738990000]
          - ["cc",41,51,1590738991000]
    sql: select * from (select c1, c2+1,c3+1 from {0});
    expect:
      columns: ["c1 string", "c2 + 1 int", "c3 + 1 bigint"]
      order: c1
      rows:
        - ["aa", 3,4]
        - ["bb", 22,32]
        - ["cc", 42,52]
  -
    id: 2
    desc: 子查询使列别名
    inputs:
      -
        columns : ["c1 string","c2 int","c3 bigint","c4 timestamp"]
        indexs: ["index1:c1:c4"]
        rows:
          - ["aa",2,3,1590738989000]
          - ["bb",21,31,1590738990000]
          - ["cc",41,51,1590738991000]
    sql: select v2,v3 from (select c2+1 as v2,c3+1 as v3 from {0});
    expect:
      columns: ["v2 int","v3 bigint"]
      order: v2
      rows:
        - [3,4]
        - [22,32]
        - [42,52]
  -
    id: 3
    desc: 子查询使用常量
    inputs:
      -
        columns : ["c1 string","c2 int","c3 bigint","c4 timestamp"]
        indexs: ["index1:c1:c4"]
        rows:
          - ["aa",2,3,1590738989000]
          - ["bb",21,31,1590738990000]
          - ["cc",41,51,1590738991000]
    sql: select * from (select c2+1 as v2,c3+1 as v3,1 as v4 from {0});
    expect:
      columns: ["v2 int","v3 bigint","v4 int"]
      order: v2
      rows:
        - [3,4,1]
        - [22,32,1]
        - [42,52,1]
  -
    id: 4
    desc: 子查询中有空串
    inputs:
      -
        columns : ["c1 string","c2 int","c3 bigint","c4 timestamp"]
        indexs: ["index1:c1:c4"]
        rows:
          - ["aa",2,3,1590738989000]
          - ["",21,31,1590738990000]
          - ["cc",41,51,1590738991000]
    sql: select * from (select c1,c2+1 as v2,c3+1 as v3,1 as v4 from {0});
    expect:
      columns: ["c1 string","v2 int","v3 bigint","v4 int"]
      order: c1
      rows:
        - ["",22,32,1]
        - ["aa",3,4,1]
        - ["cc",42,52,1]
  -
    id: 5
    desc: 子查询中有null
    inputs:
      -
        columns : ["c1 string","c2 int","c3 bigint","c4 timestamp"]
        indexs: ["index1:c1:c4"]
        rows:
          - ["aa",2,3,1590738989000]
          - [NULL,21,31,1590738990000]
          - ["cc",41,51,1590738991000]
    sql: select * from (select c1,c2+1 as v2,c3+1 as v3,1 as v4 from {0});
    expect:
      columns: ["c1 string","v2 int","v3 bigint","v4 int"]
      order: c1
      rows:
        - [null,22,32,1]
        - ["aa",3,4,1]
        - ["cc",42,52,1]
  -
    id: 6
    desc: 查询时列不在子查询中
    inputs:
      -
        columns : ["c1 string","c2 int","c3 bigint","c4 timestamp"]
        indexs: ["index1:c1:c4"]
        rows:
          - ["aa",2,3,1590738989000]
          - ["bb",21,31,1590738990000]
          - ["cc",41,51,1590738991000]
    sql: select v5 from (select c1,c2+1 as v2,c3+1 as v3,1 as v4 from {0});
    expect:
      success: false